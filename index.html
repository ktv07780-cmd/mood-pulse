<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>EMO-PULSE 2026</title>
    <script src="https://cdn.jsdelivr.net"></script>
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; }
        .ui { position: absolute; z-index: 10; width: 100%; display: flex; flex-direction: column; align-items: center; pointer-events: none; }
        .top { top: 20px; } .bottom { bottom: 40px; }
        .panel { background: rgba(20,20,20,0.9); padding: 20px; border-radius: 20px; border: 1px solid #444; pointer-events: auto; text-align: center; }
        button { padding: 10px 15px; margin: 4px; border-radius: 12px; border: 1px solid #555; background: #111; color: #fff; cursor: pointer; font-weight: bold; }
        button.selected { background: #fff; color: #000; }
    </style>
</head>
<body>
    <div class="ui top">
        <div class="panel">
            <div>1. –°–¢–ê–¢–£–° / STATUS</div>
            <button onclick="setMode('here', this)">üìç –Ø –¢–£–¢ / I AM HERE</button>
            <button onclick="setMode('focus', this)">üí≠ –î–£–ú–ê–Æ / THINKING</button>
        </div>
    </div>
    <div id="globeViz"></div>
    <div class="ui bottom" id="action-panel" style="display: none;">
        <div class="panel">
            <div id="instr">2. –ö–õ–ò–ö–ù–ò–¢–ï –ù–ê –®–ê–† / CLICK GLOBE</div>
            <div id="emotions" style="display: none;">
                <button style="color: #00ff88;" onclick="finish('joy')">–†–ê–î–û–°–¢–¨ / JOY</button>
                <button style="color: #ff4444;" onclick="finish('anger')">–ì–ù–ï–í / ANGER</button>
            </div>
        </div>
    </div>
    <script>
        const SB_URL = 'https://yhlshbefcjfzzripqlzo.supabase.co'; 
        const SB_KEY = 'sb_publishable_PVX1Hgt9KyL0r8o7DRbNAQ_gj0ixPeM';
        const supabaseClient = supabase.createClient(SB_URL, SB_KEY);
        let state = { mode: null, lat: null, lng: null };

        const world = Globe()(document.getElementById('globeViz'))
            .globeImageUrl('https://unpkg.com')
            .onGlobeClick(({ lat, lng }) => {
                if(!state.mode) return;
                state.lat = lat; state.lng = lng;
                document.getElementById('instr').style.display = 'none';
                document.getElementById('emotions').style.display = 'block';
            });

        function setMode(m, el) {
            state.mode = m;
            document.querySelectorAll('.top button').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('action-panel').style.display = 'flex';
        }

        async function finish(emotion) {
            const payload = {
                emotion: emotion, presence_type: state.mode,
                lat: state.lat, lng: state.lng,
                os: navigator.platform, browser: navigator.userAgent,
                lang: navigator.language, fingerprint: btoa(navigator.userAgent).slice(0,16)
            };
            const { error } = await supabaseClient.from('world_mood_data').insert([payload]);
            if (!error) { 
                alert('Sent! / –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!'); 
                location.reload(); 
            } else { alert('Error! Check Supabase Table Name.'); }
        }
        world.controls().autoRotate = true;
    </script>
</body>
</html>
